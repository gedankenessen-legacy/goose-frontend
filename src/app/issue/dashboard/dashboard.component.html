<header class="header">
  <b>Tickets</b>
  <div class="header__buttons">
    <button nz-button nzType="primary" (click)="toggleCardDesign()" disabled>
      PDF
    </button>
    <button
      nz-button
      nzType="primary"
      [routerLink]="['create']"
      [disabled]="cannotCreateIssue()"
    >
      Neues Ticket
    </button>
    <button nz-button nzType="primary" (click)="toggleCardDesign()">
      {{ btnCardDesignTitle }}
    </button>
    <button nz-button nzType="primary" (click)="toggleSearch()">
      <i nz-icon nzType="search" nzTheme="outline"></i>
    </button>
  </div>
</header>
<div *ngIf="searchVisible" class="search-container">
  <nz-input-group [nzSuffix]="suffixIconSearch">
    <input type="text" nz-input placeholder="Suche" [(ngModel)]="searchValue" />
  </nz-input-group>
  <ng-template #suffixIconSearch>
    <i nz-icon nzType="search"></i>
  </ng-template>
</div>

<nz-table
  #expandTable
  #filterTable
  [nzData]="listOfMapData"
  *ngIf="!cardDesign"
  [nzScroll]="{ x: '1100px' }"
>
  <thead>
    <tr>
      <th [nzSortFn]="sortColumnIssue">Ticketname</th>
      <th
        [nzFilters]="listOfFilterWorkers"
        [nzFilterFn]="filterWorker"
        [nzShowFilter]="true"
      >
        Autor
      </th>
      <th [nzSortFn]="sortColumnProgress">Fortschritt</th>
      <th
        [nzSortFn]="sortColumnState"
        [nzShowFilter]="true"
        [nzFilters]="listOfFilterStates"
        [nzFilterFn]="filterState"
      >
        Status
      </th>
      <th>Zeit</th>
      <th [nzSortFn]="sortColumnStart">Start</th>
      <th [nzSortFn]="sortColumnDeadline">Deadline</th>
      <th
        [nzFilters]="listOfFilterPriorities"
        [nzFilterFn]="filterPriority"
        [nzShowFilter]="true"
      >
        PrioritÃ¤t
      </th>
      <th>Bearbeiten</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let item of expandTable.data">
      <ng-container *ngFor="let data of mapOfExpandedData[item.key]">
        <tr *ngIf="(data.parent && data.parent.expand) || !data.parent" (click)="routeToIssue(data.issue.id)">
    <!--<tr (click)="routeToIssue(data.id)" *ngFor="let data of filterTable.data.issue">-->
      <td
      [nzIndentSize]="data.level! * 20"
      [nzShowExpand]="!!data.children"
      [(nzExpand)]="data.expand"
      (nzExpandChange)="collapse(mapOfExpandedData[item.key], data, $event)">{{ data.issue.issueDetail.name }}</td>
      <td>{{ data.issue.author?.firstname + " " + data.issue.author?.lastname }}</td>
      <td>
        <app-progress-bar
          [progress]="data.issue.issueDetail.progress"
          [expectedTime]="data.issue.issueDetail.expectedTime"
          [timeSheets]="data.issue.timeSheets"
        ></app-progress-bar>
      </td>
      <td>{{ data.issue.state?.name }}</td>
      <td>{{ "0/" + data.issue.issueDetail.expectedTime }}</td>
      <td>{{ data.issue.issueDetail.startDate | date: "dd/MM/yyyy" }}</td>
      <td>{{ data.issue.issueDetail.endDate | date: "dd/MM/yyyy" }}</td>
      <td>
        <app-priority [priority]="data.issue.issueDetail.priority"></app-priority>
      </td>
      <td>
        <button
          class="QAWrapper"
          nz-button
          nzType="primary"
          [routerLink]="[data.issue.id + '/edit']"
        >
          <i nz-icon nzType="setting"></i>
        </button>
      </td>
    </tr>
      </ng-container>
    </ng-container>
  </tbody>
</nz-table>
<app-card-design
  *ngIf="cardDesign"
  [projectId]="projectId"
  [companyId]="companyId"
  [searchValue]="searchValue"
>
</app-card-design>
